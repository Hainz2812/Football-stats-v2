<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="Match Oracle" />
<meta name="theme-color" content="#080c14" />
<title>Match Oracle</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
  :root {
    --bg: #080c14; --card: #0e1420; --border: #1e2535;
    --blue: #3d8bff; --yellow: #ffea00; --pink: #ff5c87;
    --green: #00e676; --orange: #ff9100; --red: #ff5252;
    --dim: #5a6070; --dimmer: #3a4050; --text: #e8eaf0;
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
  }
  html { -webkit-text-size-adjust: 100%; }
  body {
    background: var(--bg); color: var(--text);
    font-family: 'Courier New', monospace;
    min-height: 100vh; min-height: -webkit-fill-available;
    overflow-x: hidden;
    padding-top: var(--safe-top);
    padding-bottom: var(--safe-bottom);
  }
  body::before {
    content: ''; position: fixed; inset: 0; z-index: 0;
    background-image:
      linear-gradient(rgba(61,139,255,0.05) 1px, transparent 1px),
      linear-gradient(90deg, rgba(61,139,255,0.05) 1px, transparent 1px);
    background-size: 32px 32px; pointer-events: none;
  }
  .container {
    max-width: 680px; margin: 0 auto;
    padding: 24px 16px 60px;
    position: relative; z-index: 1;
  }

/* â”€â”€ HEADER â”€â”€ */
header { text-align: center; margin-bottom: 28px; }
.badge {
display: inline-block; font-size: 9px; letter-spacing: 3px;
color: var(â€“blue); border: 1px solid rgba(61,139,255,.3);
padding: 4px 10px; margin-bottom: 14px;
}
h1 {
font-size: clamp(38px, 10vw, 58px); font-weight: 900; line-height: 1;
letter-spacing: -2px; font-family: Georgia, serif; margin-bottom: 8px;
}
h1 span { color: var(â€“blue); text-shadow: 0 0 30px rgba(61,139,255,.4); }
.subtitle { font-size: 10px; letter-spacing: 2px; color: var(â€“dim); text-transform: uppercase; }

/* â”€â”€ CARDS â”€â”€ */
.card { background: var(â€“card); border: 1px solid var(â€“border); padding: 18px; margin-bottom: 12px; border-radius: 2px; }
.section-label { display: block; font-size: 9px; letter-spacing: 3px; color: var(â€“blue); margin-bottom: 10px; }

/* â”€â”€ INPUTS â”€â”€ */
input[type=â€œtextâ€], input[type=â€œpasswordâ€], input[type=â€œdateâ€] {
width: 100%; background: var(â€“bg); border: 1px solid var(â€“border);
color: var(â€“text); padding: 12px 14px; font-size: 16px; /* 16px prevents iOS zoom */
font-family: â€˜Courier Newâ€™, monospace; outline: none; border-radius: 0;
-webkit-appearance: none; appearance: none;
}
input[type=â€œdateâ€] { color-scheme: dark; }

/* â”€â”€ BUTTONS â”€â”€ */
.btn {
background: var(â€“blue); color: #000; border: none;
padding: 14px 20px; font-size: 13px; letter-spacing: 3px;
font-weight: 900; font-family: â€˜Courier Newâ€™, monospace;
cursor: pointer; width: 100%; margin-top: 12px;
border-radius: 0; -webkit-appearance: none;
min-height: 48px; /* touch target */
}
.btn:active { opacity: .8; }
.btn:disabled { background: var(â€“border); color: var(â€“dimmer); }
.btn-sm {
background: none; border: 1px solid rgba(61,139,255,.3); color: var(â€“blue);
font-size: 10px; letter-spacing: 2px; padding: 8px 14px;
font-family: â€˜Courier Newâ€™, monospace; cursor: pointer; border-radius: 0;
min-height: 36px;
}
.btn-test {
background: none; border: 1px solid var(â€“dimmer); color: var(â€“dim);
font-size: 10px; letter-spacing: 2px; padding: 12px 14px;
font-family: â€˜Courier Newâ€™, monospace; cursor: pointer;
margin-top: 10px; width: 100%; border-radius: 0;
min-height: 44px;
}

/* â”€â”€ KEY BAR â”€â”€ */
.key-bar {
display: flex; justify-content: space-between; align-items: center;
background: #0a1a0a; border: 1px solid rgba(0,230,118,.2);
padding: 12px 16px; margin-bottom: 12px; font-size: 12px; color: var(â€“green);
}

/* â”€â”€ LEAGUE GRID â”€â”€ */
.league-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
@media (min-width: 480px) { .league-grid { grid-template-columns: repeat(3, 1fr); } }
.league-btn {
background: var(â€“bg); border: 1px solid var(â€“border);
padding: 12px 12px; cursor: pointer; text-align: left;
font-family: â€˜Courier Newâ€™, monospace; display: flex;
flex-direction: column; gap: 3px; border-radius: 0;
-webkit-appearance: none; min-height: 56px;
}
.league-btn.active { background: #0d1e38; border-color: var(â€“blue); }
.lg-name { font-size: 11px; font-weight: 700; color: var(â€“text); line-height: 1.3; }
.lg-country { font-size: 9px; letter-spacing: 2px; color: var(â€“dimmer); }

/* â”€â”€ DATE ROW â”€â”€ */
.date-row { display: flex; gap: 8px; align-items: stretch; }
.date-row input { flex: 1; min-width: 0; font-size: 15px; }
.arrow-btn {
background: var(â€“bg); border: 1px solid var(â€“border); color: var(â€“text);
padding: 0 16px; cursor: pointer; font-size: 18px; flex-shrink: 0;
min-height: 48px; min-width: 48px; border-radius: 0; -webkit-appearance: none;
display: flex; align-items: center; justify-content: center;
}
.load-btn {
background: var(â€“blue); color: #000; border: none;
padding: 0 16px; font-size: 11px; letter-spacing: 2px;
font-weight: 900; font-family: â€˜Courier Newâ€™, monospace;
cursor: pointer; flex-shrink: 0; min-height: 48px;
border-radius: 0; -webkit-appearance: none;
}

/* â”€â”€ STATUS â”€â”€ */
.info-msg { text-align: center; color: var(â€“dimmer); font-size: 12px; letter-spacing: 2px; padding: 20px; }
.loading-msg { text-align: center; color: var(â€“blue); font-size: 12px; letter-spacing: 2px; padding: 20px; }

/* â”€â”€ ERROR BOX â”€â”€ */
.error-box { padding: 16px; background: #1a0808; border: 1px solid rgba(255,82,82,.4); margin-bottom: 12px; border-radius: 2px; }
.err-title { color: var(â€“red); font-size: 11px; letter-spacing: 2px; margin-bottom: 8px; font-weight: 700; }
.err-detail { color: #cc4444; font-size: 11px; line-height: 1.6; word-break: break-all; }
.err-hint { margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,82,82,.2); color: var(â€“dimmer); font-size: 10px; line-height: 1.7; }
.test-result { margin-top: 10px; padding: 12px 14px; font-size: 11px; line-height: 1.6; border: 1px solid; border-radius: 2px; }
.test-ok  { border-color: rgba(0,230,118,.3); color: var(â€“green); background: #0a1a0a; }
.test-fail{ border-color: rgba(255,82,82,.3); color: var(â€“red);   background: #1a0808; }

/* â”€â”€ FIXTURE LIST â”€â”€ */
.fixture-list { display: flex; flex-direction: column; gap: 4px; }
.fixture-row {
padding: 12px; background: var(â€“bg); border: 1px solid #1a2030;
cursor: pointer; border-radius: 2px;
}
.fixture-row.active { background: #0d1e38; border-color: rgba(61,139,255,.4); }
.fx-teams { display: flex; align-items: center; justify-content: space-between; gap: 6px; margin-bottom: 6px; }
.fx-team { display: flex; align-items: center; gap: 6px; flex: 1; min-width: 0; }
.fx-team.right { justify-content: flex-end; }
.fx-team img { width: 20px; height: 20px; object-fit: contain; flex-shrink: 0; }
.fx-name { font-size: 11px; font-weight: 700; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.fx-score { font-size: 12px; font-weight: 900; color: var(â€“dim); padding: 0 8px; flex-shrink: 0; }
.fx-meta { display: flex; justify-content: space-between; align-items: center; }
.fx-status { font-size: 9px; letter-spacing: 2px; border: 1px solid; padding: 2px 7px; }
.fx-cta { font-size: 9px; color: var(â€“dimmer); letter-spacing: 2px; }
.fx-predicting { font-size: 9px; color: var(â€“blue); font-style: italic; }

/* â”€â”€ RESULT â”€â”€ */
.match-banner {
display: flex; align-items: center; justify-content: space-between;
background: var(â€“card); border: 1px solid var(â€“border);
padding: 16px; margin-bottom: 12px;
}
.team-side { display: flex; flex-direction: column; gap: 5px; flex: 1; }
.team-side.right { align-items: flex-end; }
.team-side img { width: 40px; height: 40px; object-fit: contain; }
.t-name { font-size: 12px; font-weight: 700; line-height: 1.3; }
.t-tag { font-size: 8px; letter-spacing: 3px; color: var(â€“dimmer); }
.vs-badge { font-size: 18px; font-weight: 900; color: var(â€“border); padding: 0 14px; flex-shrink: 0; }
.pred-box { background: var(â€“card); border: 1px solid var(â€“border); padding: 20px 16px; margin-bottom: 12px; text-align: center; }
.pred-label { font-size: 9px; letter-spacing: 4px; color: var(â€“dimmer); margin-bottom: 8px; }
.pred-value { font-size: clamp(28px, 8vw, 36px); font-weight: 900; letter-spacing: 2px; font-family: Georgia, serif; margin-bottom: 12px; }
.conf-badge { display: inline-block; padding: 4px 14px; font-size: 10px; letter-spacing: 2px; border: 1px solid; }
.prob-section { background: var(â€“card); border: 1px solid var(â€“border); padding: 16px; margin-bottom: 12px; }
.prob-row { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
.prob-row:last-child { margin-bottom: 0; }
.prob-label { width: 80px; font-size: 9px; letter-spacing: 2px; color: var(â€“dim); flex-shrink: 0; }
.bar-track { flex: 1; height: 6px; background: #1a2030; overflow: hidden; border-radius: 2px; }
.bar-fill { height: 100%; border-radius: 2px; transition: width 1s cubic-bezier(0.25,1,0.5,1); }
.prob-pct { width: 42px; text-align: right; font-size: 13px; font-weight: 700; flex-shrink: 0; }
.xg-row { display: flex; gap: 12px; margin-bottom: 12px; }
.xg-card { flex: 1; background: var(â€“card); border: 1px solid var(â€“border); padding: 14px; text-align: center; }
.xg-label { font-size: 8px; letter-spacing: 3px; color: var(â€“dimmer); margin-bottom: 5px; }
.xg-value { font-size: 26px; font-weight: 900; font-family: Georgia, serif; }
.form-grid { display: flex; flex-direction: column; gap: 10px; margin-bottom: 12px; }
@media (min-width: 540px) { .form-grid { flex-direction: row; } }
.form-card { flex: 1; background: var(â€“card); border: 1px solid; padding: 14px; }
.form-title { font-size: 9px; letter-spacing: 2px; margin-bottom: 12px; font-weight: 700; line-height: 1.4; }
.stat-row { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 8px; border-bottom: 1px solid #0e1824; padding-bottom: 8px; }
.stat-row:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
.stat-label { color: var(â€“dim); }
.stat-value { font-weight: 700; }
.model-note { font-size: 8px; letter-spacing: 1px; color: #2a3040; text-align: center; padding: 4px; }

.hidden { display: none !important; }
@keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:none; } }
.fade-in { animation: fadeIn .3s ease; }

/* â”€â”€ INSTALL BANNER â”€â”€ */
.install-hint {
background: #0a1520; border: 1px solid rgba(61,139,255,.2);
padding: 12px 16px; margin-bottom: 16px; font-size: 10px;
color: var(â€“dimmer); line-height: 1.7; text-align: center;
}
.install-hint strong { color: var(â€“blue); }
</style>

</head>
<body>
<div class="container">

  <!-- INSTALL HINT (shown on mobile) -->

  <div class="install-hint" id="install-hint">
    ğŸ“± <strong>Add to Home Screen:</strong> tap the Share button in Safari â†’ "Add to Home Screen" to use this as an app
  </div>

  <header>
    <div class="badge">STATISTICAL ENGINE v2.1</div>
    <h1>MATCH<br><span>ORACLE</span></h1>
    <p class="subtitle">Poisson Â· Venue form Â· Last 5 games</p>
  </header>

  <!-- API KEY -->

  <div id="key-section" class="card">
    <span class="section-label">API-FOOTBALL KEY</span>
    <input type="password" id="api-key-input" placeholder="Paste your API key" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" />
    <button class="btn" onclick="saveKey()">SAVE KEY &amp; START</button>
    <button class="btn-test hidden" id="test-btn" onclick="testConnection()">TEST CONNECTION</button>
    <div id="test-result" class="hidden"></div>
  </div>
  <div id="key-bar" class="key-bar hidden">
    <span>ğŸ”‘ API key active</span>
    <button class="btn-sm" onclick="changeKey()">CHANGE</button>
  </div>

  <!-- LEAGUE -->

  <div id="league-section" class="card hidden">
    <span class="section-label">SELECT LEAGUE</span>
    <div class="league-grid" id="league-grid"></div>
  </div>

  <!-- DATE -->

  <div id="date-section" class="card hidden">
    <span class="section-label">SELECT DATE</span>
    <div class="date-row">
      <button class="arrow-btn" onclick="shiftDate(-1)">â†</button>
      <input type="date" id="date-input" />
      <button class="arrow-btn" onclick="shiftDate(1)">â†’</button>
      <button class="load-btn" onclick="loadFixtures()">LOAD</button>
    </div>
  </div>

  <div id="list-loading" class="loading-msg hidden">Loading fixturesâ€¦</div>
  <div id="list-error" class="error-box hidden">
    <div class="err-title">âš  LOAD FAILED</div>
    <div class="err-detail" id="list-error-detail"></div>
    <div class="err-hint" id="list-error-hint"></div>
  </div>
  <div id="list-empty" class="info-msg hidden">No fixtures found. Try another date.</div>

  <div id="fixture-card" class="card hidden">
    <span class="section-label" id="fixture-card-label"></span>
    <div class="fixture-list" id="fixture-list"></div>
  </div>

  <div id="pred-error" class="error-box hidden">
    <div class="err-title">âš  PREDICTION FAILED</div>
    <div class="err-detail" id="pred-error-detail"></div>
  </div>

  <div id="result-section" class="hidden"></div>

</div>
<script>
'use strict';
let API_KEY = '';
let selectedLeague = null;
let activeFixtureId = null;
let predicting = false;

// Persist key across sessions using localStorage
try {
const saved = localStorage.getItem(â€˜mo_api_keyâ€™);
if (saved) { API_KEY = saved; }
} catch(e) {}

const LEAGUES = [
{ id:39,  name:â€œPremier Leagueâ€,    country:â€œEnglandâ€,     season:2024 },
{ id:140, name:â€œLa Ligaâ€,           country:â€œSpainâ€,       season:2024 },
{ id:135, name:â€œSerie Aâ€,           country:â€œItalyâ€,       season:2024 },
{ id:78,  name:â€œBundesligaâ€,        country:â€œGermanyâ€,     season:2024 },
{ id:61,  name:â€œLigue 1â€,           country:â€œFranceâ€,      season:2024 },
{ id:94,  name:â€œPrimeira Ligaâ€,     country:â€œPortugalâ€,    season:2024 },
{ id:88,  name:â€œEredivisieâ€,        country:â€œNetherlandsâ€, season:2024 },
{ id:203, name:â€œSÃ¼per Ligâ€,         country:â€œTurkeyâ€,      season:2024 },
{ id:2,   name:â€œChampions Leagueâ€,  country:â€œEuropeâ€,      season:2024 },
{ id:3,   name:â€œEuropa Leagueâ€,     country:â€œEuropeâ€,      season:2024 },
{ id:848, name:â€œConference Leagueâ€, country:â€œEuropeâ€,      season:2024 },
{ id:253, name:â€œMLSâ€,              country:â€œUSAâ€,          season:2025 },
];

const $ = id => document.getElementById(id);
const show = id => $(id).classList.remove(â€˜hiddenâ€™);
const hide = id => $(id).classList.add(â€˜hiddenâ€™);
function todayStr() {
const d = new Date();
return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
}

// â”€â”€ API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function apiFetch(endpoint, params) {
const url = new URL(â€˜https://v3.football.api-sports.ioâ€™ + endpoint);
Object.entries(params).forEach(([k,v]) => url.searchParams.set(k, v));
let res;
try {
res = await fetch(url.toString(), { headers: { â€˜x-apisports-keyâ€™: API_KEY } });
} catch(e) {
throw { message: â€™Network request failed: â€™ + e.message,
hint: â€˜Check your internet connection. If this keeps happening, make sure you are hosting this file on a web server (not just opening it as a file).â€™ };
}
let data;
try { data = await res.json(); } catch(e) {
throw { message: `HTTP ${res.status} â€” response not JSON`, hint: â€˜Check your API key is valid.â€™ };
}
if (!res.ok) throw { message: `HTTP ${res.status} ${res.statusText}`,
hint: res.status===401||res.status===403 ? â€˜Invalid or expired API key.â€™ : `Server error ${res.status}` };
if (data.errors && Object.keys(data.errors).length)
throw { message: â€˜API error: â€™ + Object.values(data.errors).join(â€™, â€™),
hint: â€˜Check your API key and subscription plan.â€™ };
return data.response;
}

// â”€â”€ Connection test â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function testConnection() {
const btn = $(â€˜test-btnâ€™);
btn.textContent = â€˜TESTINGâ€¦â€™; btn.disabled = true;
hide(â€˜test-resultâ€™);
try {
const data = await apiFetch(â€™/statusâ€™, {});
const plan = data?.subscription?.plan ?? â€˜unknownâ€™;
const used = data?.requests?.current ?? â€˜?â€™;
const limit = data?.requests?.limit_day ?? â€˜?â€™;
$(â€˜test-resultâ€™).className = â€˜test-result test-okâ€™;
$(â€˜test-resultâ€™).innerHTML = `âœ“ Connected Â· Plan: ${plan}<br>Requests today: ${used} / ${limit}`;
show(â€˜test-resultâ€™);
} catch(e) {
$(â€˜test-resultâ€™).className = â€˜test-result test-failâ€™;
$(â€˜test-resultâ€™).innerHTML = `âœ— ${e.message}<br><span style="font-size:10px;opacity:.7">${e.hint||''}</span>`;
show(â€˜test-resultâ€™);
} finally { btn.textContent = â€˜TEST CONNECTIONâ€™; btn.disabled = false; }
}

// â”€â”€ Key â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveKey() {
const k = $(â€˜api-key-inputâ€™).value.trim();
if (!k) return;
API_KEY = k;
try { localStorage.setItem(â€˜mo_api_keyâ€™, k); } catch(e) {}
applyKeySaved();
}

function applyKeySaved() {
hide(â€˜key-sectionâ€™);
show(â€˜key-barâ€™);
show(â€˜league-sectionâ€™);
buildLeagueGrid();
}

function changeKey() {
API_KEY = â€˜â€™;
try { localStorage.removeItem(â€˜mo_api_keyâ€™); } catch(e) {}
selectedLeague = null;
[â€˜key-barâ€™,â€˜league-sectionâ€™,â€˜date-sectionâ€™,â€˜fixture-cardâ€™,â€˜result-sectionâ€™,â€˜list-errorâ€™,â€˜list-emptyâ€™,â€˜pred-errorâ€™].forEach(hide);
$(â€˜api-key-inputâ€™).value = â€˜â€™;
show(â€˜key-sectionâ€™);
}

$(â€˜api-key-inputâ€™).addEventListener(â€˜keydownâ€™, e => { if(e.key===â€˜Enterâ€™) saveKey(); });

// â”€â”€ League grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildLeagueGrid() {
const grid = $(â€˜league-gridâ€™); grid.innerHTML = â€˜â€™;
LEAGUES.forEach(lg => {
const btn = document.createElement(â€˜buttonâ€™);
btn.className = â€˜league-btnâ€™;
btn.innerHTML = `<span class="lg-name">${lg.name}</span><span class="lg-country">${lg.country}</span>`;
btn.addEventListener(â€˜clickâ€™, () => {
document.querySelectorAll(â€™.league-btnâ€™).forEach(b => b.classList.remove(â€˜activeâ€™));
btn.classList.add(â€˜activeâ€™);
selectedLeague = lg;
show(â€˜date-sectionâ€™);
if (!$(â€˜date-inputâ€™).value) $(â€˜date-inputâ€™).value = todayStr();
loadFixtures();
});
grid.appendChild(btn);
});
}

// â”€â”€ Date â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function shiftDate(days) {
const val = $(â€˜date-inputâ€™).value || todayStr();
const [y,m,d] = val.split(â€™-â€™).map(Number);
const nd = new Date(y, m-1, d+days);
$(â€˜date-inputâ€™).value = `${nd.getFullYear()}-${String(nd.getMonth()+1).padStart(2,'0')}-${String(nd.getDate()).padStart(2,'0')}`;
loadFixtures();
}

// â”€â”€ Load fixtures â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadFixtures() {
if (!selectedLeague) return;
const date = $(â€˜date-inputâ€™).value || todayStr();
[â€˜list-errorâ€™,â€˜list-emptyâ€™,â€˜fixture-cardâ€™,â€˜result-sectionâ€™,â€˜pred-errorâ€™].forEach(hide);
show(â€˜list-loadingâ€™); activeFixtureId = null;
try {
const data = await apiFetch(â€™/fixturesâ€™, { league:selectedLeague.id, season:selectedLeague.season, date });
hide(â€˜list-loadingâ€™);
if (!data.length) { show(â€˜list-emptyâ€™); return; }
$(â€˜fixture-card-labelâ€™).textContent = `${data.length} FIXTURE${data.length!==1?'S':''} Â· ${selectedLeague.name} Â· ${date}`;
const list = $(â€˜fixture-listâ€™); list.innerHTML = â€˜â€™;
data.forEach(f => {
const sb = statusBadge(f);
const row = document.createElement(â€˜divâ€™);
row.className = â€˜fixture-rowâ€™; row.id = `fx-${f.fixture.id}`;
row.innerHTML = ` <div class="fx-teams"> <div class="fx-team"> <img src="${f.teams.home.logo}" alt="" loading="lazy" onerror="this.style.display='none'"> <span class="fx-name">${f.teams.home.name}</span> </div> <div class="fx-score">${f.goals.home!==null?`${f.goals.home}â€“${f.goals.away}`:'vs'}</div> <div class="fx-team right"> <span class="fx-name">${f.teams.away.name}</span> <img src="${f.teams.away.logo}" alt="" loading="lazy" onerror="this.style.display='none'"> </div> </div> <div class="fx-meta"> <span class="fx-status" style="color:${sb.color};border-color:${sb.color}44">${sb.text}</span> <span class="fx-cta" id="cta-${f.fixture.id}">PREDICT â†’</span> </div>`;
row.addEventListener(â€˜clickâ€™, () => { if(!predicting) predictFixture(f); });
list.appendChild(row);
});
show(â€˜fixture-cardâ€™);
} catch(e) {
hide(â€˜list-loadingâ€™);
$(â€˜list-error-detailâ€™).textContent = e.message || String(e);
$(â€˜list-error-hintâ€™).innerHTML = (e.hint||â€™â€™).replace(/\n/g,â€™<br>â€™);
show(â€˜list-errorâ€™);
}
}

// â”€â”€ Predict â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function predictFixture(fixture) {
hide(â€˜pred-errorâ€™); hide(â€˜result-sectionâ€™);
predicting = true;
if (activeFixtureId) { const p=$(`fx-${activeFixtureId}`); if(p) p.classList.remove(â€˜activeâ€™); }
activeFixtureId = fixture.fixture.id;
const row = $(`fx-${fixture.fixture.id}`); if(row) row.classList.add(â€˜activeâ€™);
const homeTeam=fixture.teams.home, awayTeam=fixture.teams.away, season=fixture.league.season;
const setStep = msg => { const c=$(`cta-${fixture.fixture.id}`); if(c){c.className=â€˜fx-predictingâ€™;c.textContent=â€˜âŸ³ â€˜+msg;} };
try {
setStep(â€˜Home formâ€¦â€™);
const hFix = await apiFetch(â€™/fixturesâ€™,{team:homeTeam.id,season,venue:â€˜homeâ€™,last:5,status:â€˜FTâ€™});
setStep(â€˜Away formâ€¦â€™);
const aFix = await apiFetch(â€™/fixturesâ€™,{team:awayTeam.id,season,venue:â€˜awayâ€™,last:5,status:â€˜FTâ€™});
setStep(â€˜Calculatingâ€¦â€™);
const hm=extractForm(hFix,homeTeam.id,â€˜homeâ€™), am=extractForm(aFix,awayTeam.id,â€˜awayâ€™);
if(!hm||!am) throw{message:â€˜Not enough form data. Try a fixture later in the season.â€™};
const{homeLambda,awayLambda}=buildLambdas(hm,am);
const probs=calcProbs(homeLambda,awayLambda);
const maxProb=Math.max(probs.home,probs.draw,probs.away);
const predicted=maxProb===probs.home?â€˜HOME WINâ€™:maxProb===probs.draw?â€˜DRAWâ€™:â€˜AWAY WINâ€™;
renderResult({fixture,homeTeam,awayTeam,hm,am,probs,predicted,maxProb,conf:confidence(maxProb)});
const c=$(`cta-${fixture.fixture.id}`); if(c){c.className=â€˜fx-ctaâ€™;c.textContent=â€˜âœ“ DONEâ€™;}
} catch(e) {
$(â€˜pred-error-detailâ€™).textContent=e.message||String(e); show(â€˜pred-errorâ€™);
const c=$(`cta-${fixture.fixture.id}`); if(c){c.className=â€˜fx-ctaâ€™;c.textContent=â€˜PREDICT â†’â€™;}
} finally { predicting=false; }
}

// â”€â”€ Stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function poissonPMF(l,k){if(l<=0)return k===0?1:0;let r=-l+k*Math.log(l);for(let i=1;i<=k;i++)r-=Math.log(i);return Math.exp(r);}
function calcProbs(hL,aL){let h=0,d=0,a=0;for(let i=0;i<=8;i++)for(let j=0;j<=8;j++){const p=poissonPMF(hL,i)*poissonPMF(aL,j);if(i>j)h+=p;else if(i===j)d+=p;else a+=p;}const t=h+d+a;return{home:h/t*100,draw:d/t*100,away:a/t*100,homeLambda:hL,awayLambda:aL};}
function extractForm(fixtures,teamId,venue){
const rel=fixtures.filter(f=>venue===â€˜homeâ€™?f.teams.home.id===teamId:f.teams.away.id===teamId).slice(0,5);
if(!rel.length)return null;
let gf=0,ga=0,pts=0,cs=0;
rel.forEach(f=>{const ih=f.teams.home.id===teamId,s=ih?f.goals.home:f.goals.away,c=ih?f.goals.away:f.goals.home,w=ih?f.teams.home.winner:f.teams.away.winner,l=ih?f.teams.away.winner:f.teams.home.winner;gf+=s??0;ga+=c??0;if(w)pts+=3;else if(!l)pts+=1;if((c??1)===0)cs++;});
const n=rel.length;return{avgGoalsFor:gf/n,avgGoalsAgainst:ga/n,ppg:pts/n,cleanSheetRate:cs/n,gamesUsed:n};
}
function buildLambdas(hm,am,avg=1.35){return{homeLambda:Math.max(0.3,(hm.avgGoalsFor/avg)*(am.avgGoalsAgainst/avg)*avg*1.1),awayLambda:Math.max(0.3,(am.avgGoalsFor/avg)*(hm.avgGoalsAgainst/avg)*avg)};}
function confidence(p){if(p>=70)return{label:â€˜Strongâ€™,color:â€™#00e676â€™};if(p>=55)return{label:â€˜Moderateâ€™,color:â€™#ffea00â€™};if(p>=40)return{label:â€˜Slightâ€™,color:â€™#ff9100â€™};return{label:â€˜Uncertainâ€™,color:â€™#ff5252â€™};}
function statusBadge(f){const s=f.fixture.status.short,e=f.fixture.status.elapsed;if([â€˜1Hâ€™,â€˜2Hâ€™,â€˜HTâ€™,â€˜ETâ€™,â€˜Pâ€™].includes(s))return{text:e?`${e}'`:â€˜LIVEâ€™,color:â€™#00e676â€™};if(s===â€˜FTâ€™)return{text:â€˜FTâ€™,color:â€™#5a6070â€™};if(s===â€˜NSâ€™){const t=new Date(f.fixture.date);return{text:t.toLocaleTimeString([],{hour:â€˜2-digitâ€™,minute:â€˜2-digitâ€™}),color:â€™#3d8bffâ€™};}return{text:s,color:â€™#ff9100â€™};}

// â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderResult({fixture,homeTeam,awayTeam,hm,am,probs,predicted,maxProb,conf}){
const sec=$(â€˜result-sectionâ€™);
sec.innerHTML=` <div class="match-banner"> <div class="team-side"><img src="${homeTeam.logo}" alt="" onerror="this.style.display='none'"><span class="t-name">${homeTeam.name}</span><span class="t-tag">HOME</span></div> <div class="vs-badge">VS</div> <div class="team-side right"><img src="${awayTeam.logo}" alt="" onerror="this.style.display='none'"><span class="t-name">${awayTeam.name}</span><span class="t-tag">AWAY</span></div> </div> <div class="pred-box"> <div class="pred-label">PREDICTED OUTCOME</div> <div class="pred-value" style="color:${conf.color}">${predicted}</div> <span class="conf-badge" style="color:${conf.color};border-color:${conf.color}55;background:${conf.color}18">${conf.label} confidence â€” ${maxProb.toFixed(1)}%</span> </div> <div class="prob-section"> ${[['HOME WIN',probs.home,'#3d8bff'],['DRAW',probs.draw,'#ffea00'],['AWAY WIN',probs.away,'#ff5c87']].map(([l,p,c])=>`
<div class="prob-row">
<span class="prob-label">${l}</span>
<div class="bar-track"><div class="bar-fill" style="width:${p.toFixed(1)}%;background:${c};box-shadow:0 0 8px ${c}66"></div></div>
<span class="prob-pct" style="color:${c}">${p.toFixed(1)}%</span>
</div>`).join('')} </div> <div class="xg-row"> <div class="xg-card"><div class="xg-label">HOME xG</div><div class="xg-value">${probs.homeLambda.toFixed(2)}</div></div> <div class="xg-card"><div class="xg-label">AWAY xG</div><div class="xg-value">${probs.awayLambda.toFixed(2)}</div></div> </div> <div class="form-grid"> ${formCard(`${homeTeam.name} Â· Last ${hm.gamesUsed} Home`,hm,'#3d8bff')} ${formCard(`${awayTeam.name} Â· Last ${am.gamesUsed} Away`,am,'#ff5c87')} </div> <div class="model-note">Poisson model Â· Home adv Ã—1.1 Â· Venue-specific form only</div>`;
show(â€˜result-sectionâ€™); sec.classList.add(â€˜fade-inâ€™);
setTimeout(()=>sec.scrollIntoView({behavior:â€˜smoothâ€™,block:â€˜startâ€™}),50);
}
function formCard(title,m,color){
return`<div class="form-card" style="border-color:${color}44"> <div class="form-title" style="color:${color}">${title}</div> ${[['Avg Goals Scored',m.avgGoalsFor.toFixed(2)],['Avg Goals Conceded',m.avgGoalsAgainst.toFixed(2)],['Points Per Game',m.ppg.toFixed(2)],['Clean Sheet Rate',`${(m.cleanSheetRate*100).toFixed(0)}%`]] .map(([l,v])=>`<div class="stat-row"><span class="stat-label">${l}</span><span class="stat-value">${v}</span></div>`).join(â€™â€™)}

  </div>`;
}

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$(â€˜date-inputâ€™).value = todayStr();

// If key was saved in localStorage, skip straight to league selection
if (API_KEY) {
$(â€˜api-key-inputâ€™).value = â€˜â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€™;
applyKeySaved();
}

// Hide install hint on desktop
if (!(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent))) {
hide(â€˜install-hintâ€™);
}
</script>

</body>
</html>